<div class="$ThemeName" style="width:${xf.ViewXmlSetting("width","100%")};">
    #if(${DisplayForm})
    #if($GroupList.Count > 0)
    #foreach($GroupItem in $GroupList)
    #set($GroupFieldList = ${xf.ViewSearchFieldList($FieldList,$GroupItem)})
    #if($GroupFieldList.Count > 0)
    <div class="collapsiblediv" class="${xf.ConditionalClass($GroupItem)}" ${xf.ConditionalRule($GroupItem)}>
        <div class="group_title btn"> <span class="max">$GroupItem.Name</span> </div>
        <div class="group_inside" style="display:none">
            <ul class="form_list">
                #foreach($FieldItem in $GroupFieldList)
                <li style="width:${xf.ViewItemSetting($FieldItem,"Itemwidth","100")}%" class="${xf.ConditionalClass($FieldItem)}" ${xf.ConditionalRule($FieldItem)}>
                    #if(${xf.IsHtmlControl($FieldItem)})
                    <div class="form_row"> ${xf.ViewControl($FieldItem)}</div>
                    #else
                    <div class="form_row row${velocityCount}">
                        #if(${xf.ViewItemSetting($FieldItem,"DisplayTitle","true")}=="true")<div class="form_label"> ${xf.ViewLable($FieldItem,":")}  #if($FieldItem.Required == 1)<span class="form_required">*</span>#end</div>#end
                        <div class="form_input">
                            ${xf.ViewControl($FieldItem)}
                            #if( ${xf.ViewXmlSetting("DisplayTooltip","true")} == "true")
                            ${xf.ViewInputDefault($FieldItem)}
                            #end
                        </div>
                    </div>
                    #end
                </li>
                #end
            </ul>
        </div>
    </div>
    #end
    #end
    #end
    #if(${xf.ViewSetting("PowerForms_ImageCaptcha_Enable",false)})
    <div style="width:100%;">
        <div class="form-control-wrap">
            <div class="form_row">
                <div class="image-recaptcha-box">
                    <div class="recaptcha-image" id="image-captcha-${ModuleID}"><img src="${xf.GetImageCaptchaUrl(${xf.GetUtcTime().ToString("yy-MM-dd-HH-mm-ss")})}" data-src="${xf.GetImageCaptchaUrl("")}" /></div> 
                    <div class="sign">=</div> 
                    <input type="text" name="ImageCaptchaVal${ModuleID}" id="ImageCaptchaVal${ModuleID}" />
                    <button type="button"><svg viewBox="0 0 35 35" xmlns="http://www.w3.org/2000/svg"><path d="M1.6,16.5a1.3,1.3,0,0,1-.2-.015,1.251,1.251,0,0,1-1.04-1.43,17.277,17.277,0,0,1,33-4.014,1.25,1.25,0,1,1-2.3.969A14.777,14.777,0,0,0,2.833,15.441,1.25,1.25,0,0,1,1.6,16.5Z"></path> <path d="M33.426,13.43h-.01L23.6,13.355a1.25,1.25,0,0,1,.01-2.5h.01l8.568.065.065-8.568A1.25,1.25,0,0,1,33.5,1.111h.009a1.251,1.251,0,0,1,1.241,1.26l-.074,9.818a1.251,1.251,0,0,1-1.25,1.241Z"></path> <path d="M17.569,34.557A17.315,17.315,0,0,1,1.64,23.963a1.25,1.25,0,1,1,2.3-.969,14.777,14.777,0,0,0,28.222-3.435,1.25,1.25,0,0,1,2.47.39A17.314,17.314,0,0,1,17.569,34.557Z"></path> <path d="M1.5,33.889H1.491A1.25,1.25,0,0,1,.25,32.629l.075-9.818A1.251,1.251,0,0,1,1.584,21.57l9.819.076a1.25,1.25,0,0,1-.01,2.5h-.01L2.815,24.08,2.75,32.648A1.251,1.251,0,0,1,1.5,33.889Z"></path></svg></button>
                </div>
            </div>
        </div>
    </div>
    #end

    #if($Module.Settings_HoneypotField_Enable)
    <div style="width:100%;" class="ContactEmail${ModuleID}">
        <div class="form-control-wrap">
            <div class="form_row">
                <label for="ContactEmail${ModuleID}">Contact Email</label>
                <div class="form_input">
                    ${xf.ViewHoneypotFieldControl()}
                </div>
            </div>
        </div>
    </div>
    #end

    #if($Module.Settings_Recaptcha_Enable)
    <div class="form_captchadiv">
        <table cellpadding="0" cellspacing="0" border="0" class="form_table">
            <tr>
                <td class="form_input form_captcha"> ${xf.ViewCaptcha()} </td>
            </tr>
        </table>
    </div>
    #end
    #if($ErrorMessage != '')
    <div class="PowerForms_ErrorMessage">$ErrorMessage</div>
    #end
    <div class="form_submit">
        ${xf.ViewButton("submit_but")}

        #if(${xf.ViewXmlSetting("ShowResetButton","true")} == "true")
        ${xf.ViewResetButton("reset_but")}
        #end
    </div>

    #else
    #if(${Module.UserId} > 0)
    <div>${xf.ViewSetting("PowerForms_PromptAlreadySubmitted","You have already submitted the form.")}</div>

    #else
    <div>${xf.ViewSetting("PowerForms_PromptNotLogged","You need to log in to submit forms.")}</div>
    #end
    #end

</div>
<style type="text/css">
    
    .$ThemeName .ContactEmail${ModuleID}{
        position: absolute; 
        inset-inline: -9999px;
        width: 200px;
   }
	#form_div_${ModuleID} .actionMenu{ display:none;}
	.form_captcha{
		position:relative;
	}
	.g-recaptcha-dnn{
		padding-bottom:20px;
	}
	.form_captcha .g-recaptcha-msg{
		position:absolute;
		left:0;
		bottom:0;
		font-size:13px;
		white-space:nowrap;
		font-family:Arial, Helvetica, sans-serif;
		line-height:1;
	}
</style>

<script>
  jQuery(document).ready(function(){
    $(".form_div_${ModuleID} .group_title").click(function () {
      var _this = $(this);
      setTimeout(function() {
        _this.parent().siblings(".collapsiblediv").find("div[class='group_inside']").slideUp(300);
        _this.parent().siblings(".collapsiblediv").find(".group_title span").addClass("max").removeClass("min");
      }, 0);
    });

    setTimeout(function() {
      var index = ${xf.ViewXmlSetting("OpenIndex","0")};

      if( index > 0 ){
        $(".form_div_${ModuleID} .group_title").eq( index - 1 ).click();
      }else if( index < 0 ){
        $(".form_div_${ModuleID} .group_title").eq( index ).click();
      }else{

      }
      
    }, 0);

  })
</script>
#if(${xf.ViewSetting("PowerForms_ImageCaptcha_Enable",false)})
<script>
    $("#form_div_${ModuleID}").find(".recaptcha-image").each(function () {
        let e = $(this);
        e.data("src", e.children("img").attr("src")).on("click", function () {
            e.children("img").attr("src", e.data("src") + "&v=" + (new Date()).getTime());
            e.siblings("input").val("").trigger("focus");
            $(this).addClass("active");
        }).on("mouseout", function () {
            $(this).removeClass("active");
        });
        e.siblings("button").on("click", function (event) {
            event.preventDefault();
            e.children("img").attr("src", e.data("src") + "&v=" + (new Date()).getTime());
            e.siblings("input").val("").trigger("focus");
        });

    });
</script>
#end
