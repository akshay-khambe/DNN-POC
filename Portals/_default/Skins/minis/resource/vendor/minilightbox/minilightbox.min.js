

function miniLightbox(e) {
    var holder = $(".minilightbox-holder"),e=$(e),
        type = e.data("ilightbox")?e.data("ilightbox"):"images",
        url = e.attr("href"),
        title =e.attr("title"),
        pr= window.innerWidth -$(window).width() ,
        groupImg=false,
        currImg=false,
        imgload=false;

        if(e.find("img").hasClass("elm-active")) return false;

        if(!holder.length){
            $('body').append('<div class="minilightbox-holder" aria-hidden="true"><div class="minilightbox-close"></div><div class="minilightbox-mask"></div><div class="minilightbox-content"></div><div class="minilightbox-prev"><span></span></div><div class="minilightbox-next"><span></span></div></div>');
            holder = $(".minilightbox-holder");
        }

        $('.minilightbox-prev,.minilightbox-next').hide();

    var lightbox = $('.minilightbox-holder'),content = lightbox.find('.minilightbox-content'),html="";
        switch(type){
            case "image":
                var t =
                html ='<div class="box lightbox-image"><img src="'+url+'" alt="'+(title?title:"")+'">'+(title?'<div class="minilight-title">'+title+'</div>':'')+'</div>';
                content.addClass("loading");
            break;  
            case "youtube":
                html ='<div class="box lightbox-youtube"><iframe src="'+url+'" frameborder="0" hspace="0" vspace="0" scrolling="scroll" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="" allow="autoplay; fullscreen"></iframe></div>';
            break;
            case "vimeo":
                    html ='<div class="box lightbox-vimeo"><iframe src="'+url+'" frameborder="0" hspace="0" vspace="0" scrolling="scroll" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="" allow="autoplay; fullscreen"></iframe></div>';
                    break;
            case "html5":
                    html ='<div class="box lightbox-html5"><video preload="metadata" controls="controls" src="'+url+'">';
                    html +='<source src="'+url+'" type="video/mp4">';
                    html +='</video></div>';

                    break;
            case "content":
                html ='<div class="box lightbox-htmlcont d-wrapper"></div>';  
            break;
            case "map":
            html ='<div class="box lightbox-map"><iframe src="'+url+'" frameborder="0" hspace="0" vspace="0" scrolling="scroll" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe></div>';
            break;
        }

        function hideNextPrev(){
            lightbox.find(".minilightbox-prev,.minilightbox-next").show();
            lightbox.find(".minilightbox-prev,.minilightbox-next").removeClass("disabled");
            if(currImg==0){
                lightbox.find(".minilightbox-prev").addClass("disabled");
            }else if(currImg==groupImg.length-1){
                lightbox.find(".minilightbox-next").addClass("disabled");
            }

        }
        if(e.attr("data-group") && $('.is-lightbox[data-ilightbox="image"][data-group="'+e.attr("data-group")+'"]').length > 1 ){
            groupImg= $('.is-lightbox[data-ilightbox="image"][data-group="'+e.attr("data-group")+'"]');
            currImg = groupImg.index(e);
            hideNextPrev();
        }

        content.html(html);

        if(type =="content"){content.find(".lightbox-htmlcont").append($(url).show()).after('<div id=""></div>');}

        $("html").css({"overflow":"hidden","padding-right":pr});
        content.find("img,iframe").on("load",function(){
            content.removeClass("loading");  
        })


        lightbox.fadeIn().addClass("active");
        $(".minilightbox-close,.minilightbox-mask").one("click",function(){
            lightbox.fadeOut(function(){
                lightbox.removeClass("active"); 
                if(type =="content"){$("body").append($(url).hide())};
                content.html("");
            });
             $("html").css({"overflow":"","padding-right":''}); 
        })

        if (e.data("autoplay") && type == "html5") {
            content.find("video")[0].play();
        }


        lightbox.find(".minilightbox-prev,.minilightbox-next").off().on("click",function(){
            if($(this).hasClass("disabled")) return;
            if(groupImg){
                if($(this).hasClass("minilightbox-next")){
                    currImg ++;
                var img = groupImg.eq(currImg);
                }else{
                    currImg --;
                var img =  groupImg.eq(currImg);
                }
                hideNextPrev();
                content.removeClass("loading");  
            var url2 = img.attr("href"),
                title2 =img.attr("title"),
                type2 = img.data("ilightbox") ? img.data("ilightbox") : "image";
                imgload =true;
                content.children(".lightbox-image").addClass("remove").fadeOut(function(){
                    $(this).remove();
                    if(imgload){
                        content.addClass("loading");  
                        imgload =false;
                    }
                });
               
                var box  =$('<div class="box lightbox-image" style="display:none"><img src="'+url2+'" alt="'+(title2?title2:"")+'">'+(title2?'<div class="minilight-title">'+title2+'</div>':'')+'</div>');

                content.append(box.fadeIn());
                box.find("img").on("load",function(){
                    content.removeClass("loading");  
                    imgload =false;
                })

                setTimeout(function () {
                 
                    if (img.data("autoplay") && type2 == "html5") {
                        if (groupImg.eq(currImg).data("currentTime")) {
                            content.find("video")[0].currentTime = groupImg.eq(currImg).data("currentTime");
                        }
                        content.find("video")[0].play();
                    }
                }, 500)
                

            }
        }) 
      

}


$(document).ready(function() {
    $('.is-lightbox').on("click",function (event) {
            event.preventDefault();
           // if( typeof ModulePath == "undefined"  || ( !(typeof ModulePath == "undefined") && $(this).hasClass("elm-active"))){
            if( typeof DNNapplyTypography == "undefined" ){
                miniLightbox(this);
            //    var e= $(this);
            //   setTimeout(function(){e.removeClass("elm-active")},300) ;
            }
    });
})